<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Chamber of Inspection - git</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Chamber of Inspection</a></h1>
                <nav><ul>
                    <li><a href="/category/dev.html">Dev</a></li>
                    <li><a href="/category/personal.html">Personal</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/releasing-with-git-flow.html">Releasing with git flow</a></h1>
<footer class="post-info">
        <abbr class="published" title="2023-08-18T16:27:00+08:00">
                Published: Fri 18 August 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/mcursa.html">mcursa</a>
        </address>
<p>In <a href="/category/dev.html">Dev</a>.</p>
<p>tags: <a href="/tag/dev.html">dev</a> <a href="/tag/devops.html">devops</a> <a href="/tag/git.html">git</a> </p>
</footer><!-- /.post-info --><h2 id="git-flow-release-notes-template-and-building-to-gitlab">Git flow + release notes template  (and building to gitlab)<a class="headerlink" href="#git-flow-release-notes-template-and-building-to-gitlab" title="Permanent link">&para;</a></h2>
<h2 id="our-release-gitflow">our release gitflow:<a class="headerlink" href="#our-release-gitflow" title="Permanent link">&para;</a></h2>
<p><img alt="release gitflow" src="../images/release_git_flow.png" />
<br>
Learning to use the traditional <a href="https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow">git flow</a></p>
<p>with each release, my team runs a period of staging, the length depending on urgency. During staging, bugfixes and tweaks (for this release) will be done on <code>release-fixes</code>. this will branch from <code>release</code></p>
<p>After we are satisfied with the release candidate (rc), we will merge onto main for production release. In production, any urgent fixes will be done on the &lsquo;hotfix&rsquo; branch. This will be the only branch to branch directly off <code>main</code>.</p>
<h2 id="generating-release-notes">generating release notes<a class="headerlink" href="#generating-release-notes" title="Permanent link">&para;</a></h2>
<p>this command will generate release notes using:
- commits from previous version tag to release version tag
- release notes template</p>
<div class="highlight"><pre><span></span><code><span class="nv">VERSION</span><span class="o">=</span><span class="s1">&#39;1.0.0&#39;</span><span class="p">;</span><span class="nv">PREVIOUS_VERSION</span><span class="o">=</span><span class="s1">&#39;1.0.0.rc&#39;</span><span class="p">;</span><span class="w"> </span><span class="nv">CHANGES</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>log<span class="w"> </span>--no-merges<span class="w"> </span>origin/release<span class="w"> </span>--pretty<span class="o">=</span>oneline<span class="w"> </span>--format<span class="o">=</span><span class="s2">&quot;1. %s [%H]%d&quot;</span><span class="w"> </span><span class="nv">$VERSION</span>...<span class="nv">$PREVIOUS_VERSION</span><span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="nb">printf</span><span class="w"> </span><span class="s2">&quot;# Image\n\`\`\`\ndocker image pull registry.gitlab.com/your/app_name:</span><span class="nv">$VERSION</span><span class="s2"> # main server\ndocker image pull registry.gitlab.com/your/app_name:</span><span class="nv">$VERSION</span><span class="s2">.ocpp # ocpp server\n\`\`\` \n\n### Release Scope:\n\n### New features:\n\n### Notes:\n\n## Changes\n</span><span class="nv">$CHANGES</span><span class="s2">\n\n## Metadata\n\`\`\`\nThis version -------- </span><span class="nv">$VERSION</span><span class="s2">\nPrevious version ---- </span><span class="nv">$PREVIOUS_VERSION</span><span class="s2">\nTotal commits ------- </span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CHANGES</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l<span class="k">)</span><span class="s2">\n\`\`\`\n&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/tmp/release_notes_<span class="nv">$VERSION</span>.md<span class="p">;</span><span class="w"> </span>
vim<span class="w"> </span>/tmp/release_notes_<span class="nv">$VERSION</span>.md<span class="w"> </span><span class="c1"># can be any other text editor</span>
</code></pre></div>

<p>edit the output file to include content for:
- image tags
- release scope
  - reason for release
  - feature rollout
  - bugfixes</p>
<p>We use release scopes that are sub-scopes of our current sprint</p>
<h2 id="building-for-release">building for release<a class="headerlink" href="#building-for-release" title="Permanent link">&para;</a></h2>
<p>first make sure you are in the right version (and folder repository)</p>
<div class="highlight"><pre><span></span><code>app_name/$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>-f<span class="w"> </span><span class="m">1</span>.0.0
</code></pre></div>

<p>then build</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>registry.gitlab.com/your/app_name:1.0.0<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>push<span class="w"> </span>registry.gitlab.com/your/app_name:1.0.0
sudo<span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>ocpp.Dockerfile<span class="w"> </span>-t<span class="w"> </span>registry.gitlab.com/your/app_name:1.0.0.ocpp<span class="w"> </span>.<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>docker<span class="w"> </span>push<span class="w"> </span>registry.gitlab.com/your/app_name:1.0.0.ocpp
</code></pre></div>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>